- id: caffeine_minutely_update
  alias: "Caffeine: Minutely Sensor Update"
  description: "Trigger a state update every minute so template sensors recalculate caffeine decay."
  trigger:
    - platform: time_pattern
      minutes: "/1"
  action:
    - service: homeassistant.update_entity
      target:
        entity_id:
          - sensor.caffeine_current_level_mg
          - sensor.caffeine_peak_today_mg
          - sensor.caffeine_time_until_zero
          - sensor.caffeine_remaining_to_goal
          - sensor.caffeine_status

- id: caffeine_midnight_reset
  alias: "Caffeine: Midnight Reset"
  description: "Reset the caffeine log at midnight each day."
  trigger:
    - platform: time
      at: "00:00:00"
  action:
    - service: script.caffeine_reset_day

- id: caffeine_goal_exceeded_warning
  alias: "Caffeine: Goal Exceeded Warning"
  description: "Notify when caffeine level exceeds the daily goal."
  trigger:
    - platform: numeric_state
      entity_id: sensor.caffeine_current_level_mg
      above: input_number.caffeine_daily_goal
  action:
    - service: persistent_notification.create
      data:
        notification_id: caffeine_goal_exceeded
        title: "âš ï¸ Caffeine Goal Exceeded"
        message: >
          Your current caffeine level is {{ states('sensor.caffeine_current_level_mg') }} mg,
          which exceeds your daily goal of {{ states('input_number.caffeine_daily_goal') }} mg.

- id: caffeine_high_400mg_warning
  alias: "Caffeine: High (>400mg) Warning"
  description: "Notify when caffeine level exceeds 400 mg."
  trigger:
    - platform: numeric_state
      entity_id: sensor.caffeine_current_level_mg
      above: 400
  action:
    - service: persistent_notification.create
      data:
        notification_id: caffeine_high_400mg
        title: "ðŸš¨ High Caffeine Level"
        message: >
          Your current caffeine level is {{ states('sensor.caffeine_current_level_mg') }} mg,
          which exceeds 400 mg. Consider reducing intake.
